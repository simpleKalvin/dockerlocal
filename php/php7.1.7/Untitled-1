<?php


namespace Algorithm\Extension;

use Algorithm\AlgorithmAbstract;
use Model\Order;

class TaLuoFuHeJiHuiAlgorithm extends AlgorithmAbstract
{
    public function transform(Order $order)
    {
        $params = $this->algorithmParams($order);

        $result = $this->result($order, function ($order) use ($params) {
            return $params;
        });
        $thumb = array();
        $guide = [
            '<p style="color: #990000">昔日的相爱之人，此刻是否也在想着你？她还惦记着那些甜蜜吗？</p>',
            '<p style="color: #7428d1">关于复合之路，你们之间存在的问题是什么…</p>',
            '',
            '<p style="color: #1a8b87">如果想要挽回这段感情，你需要做的是什么…</p>',
        ];
        foreach ($result as $key => &$value) {
            $thumb[] = $value['dec']['img_url'];
            $thumbKey = $key + 1;
            $value['thumb_url'] = "https://s103.ggwan.com/zxcs/forecast/ziweitaluo/re_title_0{$thumbKey}.png";
            $value['guide'] = $guide[$key];
        }

        $response = [
            'user_info' => [
                'name' => $params['name'],
                'gender' => $params['gender'] == 'male' ? '男' : '女'
            ],
            'thumb' => $thumb,
            'data' => $result
        ];
        return $this->langConvert($response);
    }

    public function detain(Order $order)
    {
        $params = $this->algorithmParams($order);

        $result = $this->result($order, function ($order) use ($params) {
            return $params;
        });
        $thumb = array();
        $guide = [
            '<p style="color: #990000">昔日的相爱之人，此刻是否也在想着你？她还惦记着那些甜蜜吗？</p>',
            '<p style="color: #7428d1">关于复合之路，你们之间存在的问题是什么…</p>',
            '',
            '<p style="color: #1a8b87">如果想要挽回这段感情，你需要做的是什么…</p>',
        ];
        $result = $result[1];

        $thumb[] = $result['dec']['img_url'];
        $thumbKey = 1;
        $result['thumb_url'] = "https://s103.ggwan.com/zxcs/forecast/ziweitaluo/re_title_0{$thumbKey}.png";
        $result['guide'] = $guide[0];

        $response = [
            'username' => $params['name'],
            'taro' =>[
                'image'=> $result['dec']['img_url'],
                'thumb_url' => $result['thumb_url'],
                'title'=> $result['dec']['pai_ming']['dec'],
                'pos'  => $result['dec']['pai_wei']['dec'],
            ],
        ];
        return $this->langConvert($response);
    }
}
